

# 基础概念

## 同步 Synchronous/异步 Asynchronous

同步方法：调用一旦开始，调用者必须等到方法调用返回后，才能继续后续行为

异步方法：调用一旦开始，立即返回，调用者可以继续后续的操作，如需返回结果，当异步调用真实完成时，会通知调用者

## 并发 Concurrency/并行 Parallelism

并发：偏重于多个任务交替执行，多任务间有可能还是串行

并行：真正意义上的任务同时执行

一个cup一次只能执行一条指令，这种情况下多进程、多线程就是并发的，不是并行，操作系统会不停的切换任务，真实的并行出现在拥有多核cup的情况下

## 临界区

临界区用来表示公共资源、共享数据，可以被多个线程访问，但每一次，只能有一个线程使用，临界区资源被占用，其他线程想要使用临界区资源，只能等待

## 阻塞 Blocking/非阻塞 Non-Blocking

阻塞、非阻塞用来形容多线程间的互相影响

阻塞：一个线程占用临界区资源，其他需要该资源的线程必须等待，等待导致线程挂起

非阻塞：没有一个线程可以妨碍其他线程

## 线程活跃性

死锁 Deadlock：A任务等待B任务，B任务等待C任务，C任务等待A任务

饥饿 Starvation：一个或多个线程因其他原因无法获得所需资源，导致一直无法执行

	1. 线程优先级太低，而高优先级的线程不断抢占资源，倒入地优先级线程无法工作
	2. 某一个线程一直占用着资源不释放，其他需要这个资源的线程无法正常执行
	
活锁 Livelock：A线程主动将资源释放B线程，B线程获得资源后主动释放给A线程，资源不断的带A、B两个线程间跳动

# 并发级别

## 阻塞 Blocking

一个线程是阻塞的，在其他线程释放资源前，当前线程无法继续执行

synchronized、重入锁都会在访问临界区资源前得到临界区的锁，如果得不到，线程会被挂起等待，直到获得锁

## 无饥饿 Starvation-Free

非公平锁：允许高优先级的线程插队，可能导致饥饿

公平锁：满足先来后到，不会产生饥饿

## 无障碍 Obstruction-Free

最弱的非阻塞调度机制，允许多个线程在没有锁的情况下进入临界区，当多个线程修改共享资源时，一旦检测到，线程会立刻对自己所做的修改进行回滚

当临界区内存在严重冲突时，所有线程可鞥都会不断地回滚自己的操作，没有一个线程可以走出临界区

## 无锁 Lock-Free

无锁的并行都是无障碍，所有线程都尝试对临界区进行访问，无锁保证必然有一个线程能够在有限步内完成操作离开临界区，其他线程需要回滚

在无障碍、无锁中，当线程不断尝试修改，不断回滚，则会出现饥饿现象

## 无等待 Lock-Free

在无锁的基础上扩展，要求所有线程都必须在有限步内完成，避免出现饥饿现象

# Java内存模型

## 原子性 Atomicity

一个操作不可中断，多个线程一起执行时，一个操作一旦开始，就不会被其他线程干扰

static int i; A线程 i=1，B线程i=-1,不管两个线程以何种方式，何种步调工作，i的值要么是1,要么是-1

32位系统中long类型的读写不是原子性的，因为long占用64位空间，两个线程同时对long进行读/写操作，线程间的结果有干扰的可能发生

## 可见性 Visibility

当一个线程修改了某共享变量的值，其他线程是否能够立即知道这个修改

## 有序性 Ordering

程序执行时，可能会进行指令重排，重排的指令与原指令的顺序未必一直

指令重排可以保证串行语义一致，但不能保证多线程语义也一致

### Hapen-Before原则

1. 一个线程内保证语义串行性
2. volatile变量的写先于读，保证变量可见性
3. unlock先于lock
4. A先于B，B先于C，A一定先于C
5. Thead.start()先于Thread.run()
6. 
7. 
8. 对象构造函数执行先于finalize()

# 线程状态

	public enum State {
		/**
	    	刚刚创建的线程，还没开始执行，离开NEW状态后将不能在回到NEW状态
		 */      
		NEW,

		/**
	       	调用start()
		 */
		RUNNABLE,
		
		/**
	       	在RUNNABLE状态中，遇到了synchronized，会进入到BLOCKED中，暂停线程执行，直到获取请求的锁
		 */        
		BLOCKED,

		/**
	       	进无时间限制的等待，wait()等待notify()，join()等待线程目标线程的终止
		 */       
		WAITING,

		  /**
	     	进有时间限制的等待，wait()等待notify()，join()等待线程目标线程的终止
		 */     
		TIMED_WAITING,

		/**
	       	线程执行结束，处于TERMINATED状态的线程不能在回到其它状态
		 */
		TERMINATED;
  	}










